# Language Features

| **FEATURE**                                       | **USAGE**                                                    | **SUPPORT STATUS**                                           | **COMMENTS & WORKAROUNDS**                                   |
| ------------------------------------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| **6.2.1 Scopes of identifiers**                   | Define scope and visibility rules                            | Supported by LLVM                                            |                                                              |
| **6.2.2 Linkages of identifiers**                 | Define linkage types: external, internal, no linkage         | Supported but not in the default pipeline. LLVM bitcode linkage is required | The linker has to support linkage of multiple translation units.The workaround is to compile each translation unit into LLVM IR: *clang -S -c -O3 input1.c -emit-llvm -o input1.ll* *clang -S -c -O3 input2.c -emit-llvm -o input2.ll* Link the IR together: *llvm-link input1.ll input2.ll -o input.bc* And compiling the result: *clang -O3 -S -c input.bc* |
| **6.2.3 Name spaces of identifiers**              | Define classes of identifiers with disambiguation rules      | Supported by LLVM                                            |                                                              |
| **6.2.4 Storage durations of objects**            | Define automatic, static and other lifetimes                 | Supported by LLVM                                            |                                                              |
| **6.2.5 Types**                                   | Define types in C                                            |                                                              |                                                              |
| **Integer types**                                 | _Bool, char, short, int, long, long long as well as their signed and unsigned counterparts | Now a workaround is implemented, proper i257 is work in progress | All integers are 257 bits wide                               |
| **Floating point types**                          |                                                              | Not supported                                                | Floating point type does not exist in the TVM. It only works with 257-bit integers. |
| **Complex types**                                 | Complex numbers                                              | Not supported                                                | Complex types do not exist in the TVM. It only works with 257-bit integers. |
| **Enumerations**                                  |                                                              | Supported by LLVM                                            |                                                              |
| **Void type**                                     |                                                              | Supported by LLVM                                            |                                                              |
| **Array type**                                    |                                                              | Supported, see notes                                         | Dynamic arrays not supported, optimizations pending. Arrays are currently implemented as general memory (via dictionaries), but tuples are considered. Also, additional testing is needed. |
| **Structure type**                                |                                                              | Supported, see notes                                         | byval mishandling is a known issue. There are two types of transfer: by value and by reference. Byval is not supported, so the **workaround** is to use transfer by reference. |
| **Union type**                                    |                                                              | Supported                                                    |                                                              |
| **Function type**                                 |                                                              | Supported                                                    |                                                              |
| **Point type**                                    |                                                              | Supported                                                    |                                                              |
| **Qualifiers**                                    | const, volatile, restrict                                    | Supported by LLVM                                            | Persistent data handling needs coverage                      |
| **6.2.5.9 Representation of unsigned types**      | Specifies that overflow is not possible for unsigned integers | Not supported                                                | Unsigned integers currently work the same way signed ones do. We have more testing in the pipeline and do not recommend using coding practices and tricks that rely on overflow values. |
| **6.2.6 Representations of types**                | Restrict binary representation of values                     | Supported by LLVM                                            | We use [SMR](https://en.wikipedia.org/wiki/Signed_number_representations) for signed numbers and it is in line with the specification (6.2.6.2). It also allow representing signed numbers with more bits than its unsigned counterpart. |
| **6.2.7 Compatible type and composite type**      | Define value conversion rules                                | Supported by LLVM                                            |                                                              |
| **6.3 Conversions**                               | Define type conversion rules                                 | Supported by LLVM                                            | All the conversions are supported, but testing is still in progress |
| **6.4 Lexical elements**                          | Define C syntax                                              | Supported by LLVM                                            | The syntax was not changed                                   |
| **6.5 Expressions**                               | Define rules to build an expression in C and the relevant semantics | Generally supported, additional checking may be required     | bitwise operations on signed integers contain implementation particularities. No SMR issues expected unless Clang assumes a different representation |
| **6.6 Constant Expressions**                      | Defines expressions that are calculated in compile time, defines the `sizeof` semantics | The feature itself is supported by LLVM, but we supply Clang with false integer type size information. i257 activities block the feature | Full support requires correct operation of sizeof work making sure that ` (T*)((char *)a + sizeof(*a))` is the same as` &a[1]` |
| **6.7 Declarations, except 6.7.8 Initialization** | Define how syntax and semantics of declarations (and definitions in C) | Supported by LLVM                                            |                                                              |
| **6.7.8 Initialization**                          | Defines value initialization                                 | Pending, testing in progress                                 | Issues not supporting implicit 0 initialization for static data were tested. Now it is necessary to makes sure that all initialization cases from N1256 (C99) work correctly and that the linker supports all related sections. For example, the **.comm** directive is not supported now. |
| **6.8 Statements and blocks**                     | Define constructs shaping control-flow in C: loops, if, switch, goto, return, etc | Supported                                                    | More optimization needed. Switch is currently lowered with *LLVM lowerswitch* pass, native support under consideration, as well as additional control-flow optimizations |
| **6.9 External definitions**                      |                                                              | Define how external function and objects are declared in C   | Not supported by the Linker, workaround to be provided       |
| **6.10 Preprocessing directives**                 |                                                              | `#define`, `#include`, etc                                   | Supported by LLVM                                            |
| **J.2 Undefined behavior**                        |                                                              | Limited support                                              | Tests and feedback needed                                    |
| **TVM builtins**                                  | For each core, non-stack manipulation instruction in TVM there has to be an intrinsic-based way to generate it in the compiler. A low-level library developer has to be familiar with these intrinsics. For example an LDU instruction accessible via the **llvm.tvm.ldu** intrinsic. | Partially supported, more effort needed                      | Limitation related to the current runtime implementation     |
| **TVM annotations**                               | Denote special meaning for functions (e.g. sign check, public method, etc.) and data (e.g. persistent data) | Partially supported                                          | Naming rules used instead of annotations (not optimal)       |
| **Persistent data semantic**                      |                                                              | Supported                                                    | More optimizations needed                                    |

# C Standard Library

|                                                              |                                                              |                                                              |                                                              |
| ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| **FEATURE**                                                  | **USAGE**                                                    | **SUPPORT STATUS**                                           | **COMMENTS & WORKAROUNDS**                                   |
| **7.1.3 Reserved identifiers**                               | Define the list of identifiers that have to be avoided in our libraries | Reserved identifiers are used                                |                                                              |
| **7.2 Diagnostics<assert.h>**                                | Defines the assert macro: a standard debugging tool used by C / C++ developers | Not supported                                                |                                                              |
| **7.4 Character handling <ctype.h>**                         | Character operations                                         | Not supported, low priority                                  |                                                              |
| **7.57.10 Sizes of integer types <limits.h> Errors <errno.h>** | A low level method for handling errors in  the library and in system calls | Not supported                                                | Considered for support if required to achieve compatibility with other parts of the C standard library |
| **7.8 Format conversion of integer types <inttypes.h>**      | Used for printing, converting to/from strings and for some auxiliary functions | Not supported, low priority                                  |                                                              |
| **7.10 Sizes of integer types <limits.h>**                   | Integer type size definition                                 | Not supported, but considered for implementation             |                                                              |
| **7.15 Variable arguments <stdarg.h>**                       | Variable argument processing                                 | Not supported                                                |                                                              |
| **7.16 Boolean type and values <stdbool.h>**                 | Define `bool`, `true`, `false` and `_ _bool_true_false_are_defined` | Not supported, but planned to                                |                                                              |
| **7.17 Common definitions <stddef.h>**                       | Define `ptrdiff_t`, `size_t`, `wchar_t`, `NULL`, `offsetof`  | Not supported                                                |                                                              |
| **7.18 Integer types <stdint.h>**                            | Used to define `intN_t`, `intptr_t`, and other integer types, as well as macro that set their limits | Not supported                                                | Considered for implementation if proves to help  serialization / deserialization |
| **7.20 General utilities<stdlib.h>**                         | Used to define general utility items that we do not seem to need now except for the functions listed below | Not supported, only partial implementation can be planned    |                                                              |
| **7.20.3 Memory management functions**                       | `calloc`, `malloc`, `realloc`, `free`                        | Not supported, high priority                                 |                                                              |
| **7.20.4 Communication with the environment**                | `abort`, `exit`, `atexit`, `_Exit`, `getenv`, `system`       | Not supported, low priority                                  | Standard C program termination mechanisms under consideration |
| **7.20.5 Searching and sorting utilities**                   |                                                              | Not supported, partially implemented and being tested        |                                                              |
| **7.21 String handling<string.h>**                           | Stings & memory operations                                   | Not implemented, only the features below have priority       |                                                              |
| **7.21.2 Copying functions**                                 | memcpy, memmove, aslo its string conterparts.                | Implemented partially in the runtime, needs to be moved to the std lib |                                                              |
| **7.21.4 Comparison functions**                              | `memcmp`                                                     | Not implemented                                              |                                                              |
| **7.21.6 Miscellaneous functions**                           | `memset`                                                     | Implemented as a part of the runtime, need to be moved to the std lib |                                                              |
| **7.23 Date and time <time.h>**                              |                                                              | Not implemented                                              |                                                              |

# C for TVM

Numbers in the Feature column indicate references to the TON TVM specification. Please, refer to the original document. 

| **FEATURE**                                     | **USAGE**                                                    | **SUPPORT STATUS**                    | **COMMENTS**                                                 |
| ----------------------------------------------- | ------------------------------------------------------------ | ------------------------------------- | ------------------------------------------------------------ |
| **TVM types**                                   |                                                              | Partially implemented                 | Only integers are supported                                  |
| **Operations with cells (A.7)**                 | Slice, Builder, Dictionary, Message, External & Internal addresses, etc. | Partially implemented in the runtime  | Standard node operations involve data types specified in Assembly instructions. These Assembly instructions are converted into C equivalents at some point of the optimization process |
| **Operations with dictionaries (A.10)**         | `#include <cell.h>`                                          | Limited implementation in the runtime | A low level library that is implemented via cell intrinsics to provide developer-friendly cell handling options. |
| **GAS related logic (A.11.2)**                  | Functions to buy gas for Grams and vice versa, defines gas limits | Not implemented                       | Same as above for dictionaries                               |
| **Operations with time (A.11.4)**               | Current time, time of the current block and transaction      | Not implemented                       |                                                              |
| **Hashing and cryptography (A.11.5)**           |                                                              | Not implemented                       |                                                              |
| **Currency** **manipulation (A.11.6)**          | Loads and stores Grams                                       | Partial implementation                |                                                              |
| **Message serialization**                       |                                                              | Implemented                           |                                                              |
| **Message deserialization**                     |                                                              | Implemented                           |                                                              |
| **Outbound message and output action (A.11.8)** |                                                              | Partially implemented                 | Sending messages available                                   |
| **Debug support (A.12)**                        |                                                              | Partially implemented                 | For more details on available debugging options, navigate to the [**Debugging options**](https://docs.ton.dev/86757ecb2/p/065f99/t/0217cc) topic. |
| **Events emitting**                             |                                                              | Not implemented                       | Planned                                                      |

#   Convenience

| **FEATURE**                                                  | **USAGE**                                                    | **SUPPORT STATUS** | **NOTES & SUGGESTIONS** |
| ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------ | ----------------------- |
| Toolchain support in the driver: the driver should use our std lib headers (or don't use it at all) instead of using the system ones |                                                              | Not implemented    | Planned                 |
| Toolchain support in the driver: default pipeline is to be available | `clang -O3 input.c `should produce a .boc file (or return a compilation error) | Not implemented    | Planned                 |